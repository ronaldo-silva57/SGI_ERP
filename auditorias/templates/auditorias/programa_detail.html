{% extends 'base.html' %}

{% block title %}Programa {{ programa.ano }} - Zenith QMS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-calendar-check me-2"></i>Programa de Auditoria {{ programa.ano }}
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="{% url 'auditorias:programa-update' programa.pk %}" class="btn btn-outline-secondary">
                <i class="bi bi-pencil me-1"></i>Editar
            </a>
            <a href="{% url 'auditorias:programa-list' %}" class="btn btn-outline-primary">
                <i class="bi bi-arrow-left me-1"></i>Voltar
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Informações do Programa</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Ano:</strong></div>
                    <div class="col-sm-9">{{ programa.ano }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Objetivo:</strong></div>
                    <div class="col-sm-9">{{ programa.objetivo|linebreaks }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Escopo:</strong></div>
                    <div class="col-sm-9">{{ programa.escopo|linebreaks }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Critérios:</strong></div>
                    <div class="col-sm-9">{{ programa.criterios|linebreaks }}</div>
                </div>
            </div>
        </div>

        <!-- Auditorias Relacionadas -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Auditorias deste Programa</h5>
            </div>
            <div class="card-body">
                {% if programa.auditoria_set.all %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Setor Auditado</th>
                                <th>Data Planejada</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for auditoria in programa.auditoria_set.all %}
                            <tr>
                                <td>{{ auditoria.numero }}</td>
                                <td>{{ auditoria.setor_auditado }}</td>
                                <td>{{ auditoria.data_planejada|date:"d/m/Y" }}</td>
                                <td>
                                    {% if auditoria.status == 'concluida' %}
                                        <span class="badge bg-success">Concluída</span>
                                    {% elif auditoria.status == 'executacao' %}
                                        <span class="badge bg-warning">Em Execução</span>
                                    {% elif auditoria.status == 'cancelada' %}
                                        <span class="badge bg-danger">Cancelada</span>
                                    {% else %}
                                        <span class="badge bg-info">Planejada</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'auditorias:auditoria-detail' auditoria.pk %}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <p class="text-muted">Nenhuma auditoria vinculada a este programa.</p>
                    <a href="{% url 'auditorias:auditoria-create' %}" class="btn btn-primary btn-sm">
                        <i class="bi bi-plus-circle me-1"></i>Criar Auditoria
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Ações</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'auditorias:programa-update' programa.pk %}" class="btn btn-outline-primary">
                        <i class="bi bi-pencil me-1"></i>Editar Programa
                    </a>
                    <a href="{% url 'auditorias:auditoria-create' %}" class="btn btn-outline-success">
                        <i class="bi bi-plus-circle me-1"></i>Criar Auditoria
                    </a>
                    <a href="{% url 'auditorias:programa-list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-list me-1"></i>Ver Todos Programas
                    </a>
                    <a href="{% url 'auditorias:programa-delete' programa.pk %}" class="btn btn-outline-danger">
                        <i class="bi bi-trash me-1"></i>Excluir Programa
                    </a>
                    <a href="{% url 'auditorias:programa-historico' programa.pk %}" class="btn btn-outline-info">
                        <i class="bi bi-clock-history me-1"></i>Histórico
                    </a>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Estatísticas</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h4>{{ programa.auditoria_set.count }}</h4>
                        <small class="text-muted">Total Auditorias</small>
                    </div>
                    <div class="col-6">
                        <h4>{{ programa.auditoria_set.filter.status='concluida').count }}</h4>
                        <small class="text-muted">Concluídas</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}